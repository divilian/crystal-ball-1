
\chapter{Exploratory Data Analysis: bivariate (2 of 2)}
\label{ch:edaBivariate2}

\section{Three bivariate scenarios}

\index{scales of measure}
\index{categorical variable}
\index{nominal variable}

As we saw with univariate data in chapter~\ref{ch:edaUnivariate}, different
kinds of plots and statistics are appropriate depending on the variable's scale
of measure -- categorical or numeric. There are thus three different cases for
bivariate analysis:

\begin{compactitem}
\item Two categorical variables
\item One categorical variable and one numeric variable
\item Two numeric variables
\end{compactitem}

We'll consider each case in turn. Throughout all the remaining sections, we'll
use this fictitious data set, called \texttt{people}:

\begin{Verbatim}[fontsize=\small,samepage=true,frame=leftline,framesep=5mm,framerule=1mm]
   gender  salary   color  followers
0    male   54.94  purple         26
1  female   72.48  purple         22
2    male    9.47    blue         27
3   other   60.08     red         22
4    male   37.62     red         13
                .
                .
\end{Verbatim}

Each row represents one fictional person we interviewed, and includes their 
\texttt{gender}, their \texttt{salary} (in thousands of dollars per year),
their favorite \texttt{color}, and the number of \texttt{followers} they have
on some unspecified social media website.

The \texttt{DataFrame} has 5000 rows, and no special ``index'' variable: none
of the columns that we collected are unique, so we just let Pandas default to
indexing the rows by number, 0 through 4,999.

\section{Importing \texttt{scipy.stats}}

\index{importing (a package)}

All of the statistical tests we'll demonstrate in this chapter come from the
\textbf{SciPy} Python package (pronounced ``sigh pie.'') SciPy is huge, and has
several different parts; for the time being, we'll only be using the
``\texttt{stats}'' component. Therefore, we need one additional import statement:

\begin{Verbatim}[fontsize=\small,samepage=true,frame=single,framesep=3mm]
import scipy.stats
\end{Verbatim}

You can include this in a cell at the top of your Jupyter Notebook just like
your \texttt{numpy} and \texttt{pandas} imports.


\section{Two categorical variables}

\index{value\_counts@\texttt{.value\_counts()} method (Pandas)}
\index{bar chart}

Okay. Let's return our attention to the \texttt{people} \texttt{DataFrame}, and
begin with a bivariate analysis of the \texttt{gender} and \texttt{color}
columns. The first thing we should do, of course, is inspect each one
individually, using \texttt{.value\_counts()} and perhaps a bar chart from
sections~\ref{categoricalDataValueCounts} and \ref{categoricalDataBarCharts}.
Let's say we've done that.

\index{association}

The next obvious question: is there an \textit{association} between the two
variables? In other words, are there particular values of one that tend to go
with particular values of the other? In still other words, do people of
different genders tend to have different favorite colors?

\index{contingency table}

\subsection{Contingency tables}

The first tool to get at this question is called a \textbf{contingency table}.
This is very much like \texttt{.value\_counts()}, but for two variables instead
of one. Our function is \texttt{crosstab()} from the Pandas package: if we give
it two columns as arguments, it computes the complete set of counts from all
possible combinations of variables. Here's what it looks like:

\begin{Verbatim}[fontsize=\small,samepage=true,frame=single,framesep=3mm]
pd.crosstab(people.gender, people.color)
\end{Verbatim}
\vspace{-.2in}

\begin{Verbatim}[fontsize=\small,samepage=true,frame=leftline,framesep=5mm,framerule=1mm]
color   blue  green  pink  purple  red  yellow
gender                                        
female   240    402   665     644  289     378
male    1403      0     0     248  463     258
other      1      2     2       2    1       2
\end{Verbatim}

Interpreting this is straightforward. Every cell in the matrix tells us how
many people had a particular gender and a particular favorite color. For
instance, there were 378 females who named \texttt{yellow} as their favorite
color, and no males at all chose \texttt{green}.

% Margins? Or is that 219 only?

\subsection{Plotting two categorical variables}

So now we have a table of counts -- how to turn this into a pretty and
informative plot?

Unfortunately, there doesn't seem to be any great way to do this. There's
something called a ``mosaic plot'' which attempts it, but they're not very easy
to visually interpret. Another option is a ``heat map,'' which essentially
reproduces the above table as squares in a grid, with each square color coded
on a continuum by its height (for instance, low numbers might be dark blue and
high numbers bright yellow, with a rainbow spectrum of number in between).
That's sort of okay, but to be honest I prefer to just look at the numbers.

\subsection{The $\chi^2$ test}

\index{$\chi^2$@$\chi^2$ test}

The statistical test to use for two categorical variables is called the
\textbf{$\chi^2$ test} (pronounced ``kai-squared,'' not ``chai-squared,'' by
the way). To run it, it's convenient to first store the contingency table
itself as a variable. I'll call it \texttt{gender\_color} since it's a table of
the genders of people and their favorite colors:

\begin{Verbatim}[fontsize=\small,samepage=true,frame=single,framesep=3mm]
gender_color = pd.crosstab(people.gender, people.color)
\end{Verbatim}

\index{chi2\_contingency@\texttt{chi2\_contingency()} (SciPy)}
Now, we run the test by calling the \texttt{chi2\_contingency()} function from
SciPy:

\begin{Verbatim}[fontsize=\footnotesize,samepage=true,frame=single,framesep=3mm]
scipy.stats.chi2_contingency(gender_color)
\end{Verbatim}
\vspace{-.2in}

\begin{Verbatim}[fontsize=\small,samepage=true,frame=leftline,framesep=5mm,framerule=1mm]
(2125.893343592046, 0.0, 10, array([[8.607984e+02, 2.115344e+02, 
    3.492412e+02, 4.680984e+02, 3.942708e+02, 3.340568e+02],
   [7.799136e+02, 1.916576e+02, 3.164248e+02, 4.241136e+02, 
    3.572232e+02, 3.026672e+02],
   [3.288000e+00, 8.080000e-01, 1.334000e+00, 1.788000e+00, 
    1.506000e+00, 1.276000e+00]]))
\end{Verbatim}

\index{bananas (parentheses)}
\index{()@\texttt{()} (bananas)}
\index{boxies (square brackets)}
\index{[]@\texttt{[]} (boxies)}

I know, I know: that output is downright hideous. Here's the deal, though: all
you have to do is look at \textit{the second number} in that long,
banana-and-boxie-laden thing. \textbf{The second number is the $p$-value.} It is
0.0. This is obviously lower than .05 (our $\alpha$), and therefore, \textit{we
\underline{can} conclude that \texttt{gender} and \texttt{color} are
associated.}

All the other stuff in that output are fine-grained details that statisticians
like to pore over. For us, the only thing we need to see from a $\chi^2$ (or
any other) test is the $p$-value.

\section{One categorical and one numeric variable}

\index{value\_counts@\texttt{.value\_counts()} method (Pandas)}
\index{bar chart}

Now let's consider the 
