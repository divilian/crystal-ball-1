
\chapter{Branching}
\label{ch:branching}

\index{non-linear}
\index{branching}
\index{conditional execution}

In this chapter, we'll learn our next programming trick: how to execute code
\textit{conditionally}. This is called \textbf{branching}. It's another variant
of non-linear programming, like the loops from chapter~\ref{ch:loops}: it
enables something other than the strict, start-to-finish, line-by-line
execution of a program. In particular, branching allow us to designate certain
lines of code to be executed ``only sometimes.''

\section{The \texttt{if} statement}

\index{if statement@\texttt{if} statement}

The main branching statement in Python and most languages is the
\textbf{\texttt{if} statement}. Here's a couple of them in action:

\index{cash\_on\_hand@\texttt{cash\_on\_hand}}

\begin{Verbatim}[fontsize=\small,samepage=true,frame=single,framesep=3mm]
 1: name = "Horace"
 2: cash_on_hand = 100000
 3: IQ = 90
 4: print("Nice to meet you, {}!".format(name))
 5: if cash_on_hand > 5000:
 6:     print("Wow, you're rich! Gimme a fiver.")
 7:     cash_on_hand = cash_on_hand - 5
 8: if IQ > 100:
 9:     print("Wow, you're smart! Read a book.")
10:     IQ = IQ + 5
11: print("{}'s IQ is {} and he has ${}.".format(name, IQ, cash_on_hand))
\end{Verbatim}
\vspace{-.2in}

Even without any explanation, you might be able to figure out that the output
of the code snippet above is:

\begin{Verbatim}[fontsize=\small,samepage=true,frame=leftline,framesep=5mm,framerule=1mm]
Nice to meet you, Horace!
Wow, you're rich! Gimme a fiver.
Horace's IQ is 90 and he has $99995.
\end{Verbatim}

If not, stay tuned.

\index{loop!header}
\index{loop!body}
\index{indentation}

Just like a \texttt{for} loop, every \texttt{if} statement has a header and a
body. And just like a \texttt{for} loop, the determining factor of which lines
constitute the body depends on the indentation:

\begin{compactitem}
\item[\leftpointright] The first \texttt{if} statement's header is line \textbf{5}.
\item[\leftpointright] The first \texttt{if} statement's body is lines \textbf{6 and 7}.
\item[\leftpointright] The second \texttt{if} statement's header is line \textbf{8}.
\item[\leftpointright] The second \texttt{if} statement's body is lines
\textbf{9 and 10}.
\end{compactitem}

\index{condition (of an \texttt{if} statement)}

When an \texttt{if} statement is reached, its \textbf{condition} is evaluated;
in the first case, the condition ``\texttt{cash\_on\_hand > 500}'' is evaluated
to \texttt{True}, and in the second case, ``\texttt{IQ > 100}'' is determined
to be \texttt{False}. Then, \textit{only if} the condition is true will the
body of the \texttt{if} statement execute. Otherwise, it'll be skipped over.

Thus, the lines of the above program execute in this order: 1, 2, 3, 4, 5, 6,
7, 8, 11. Lines 9 and 10 are skipped entirely, since Horace's IQ wasn't above
average. Observe that the \texttt{cash\_on\_hand} variable was updated inside
the body of the first \texttt{if} statement, but that \texttt{IQ} was not.

\subsection{Compound conditions}

\index{compound condition}

Conditions can be more complicated than the ones above; just as with queries
(p.~\pageref{seriesCompoundQueries}) they can contain more than one component:

\begin{Verbatim}[fontsize=\small,samepage=true,frame=single,framesep=3mm]
if cash_on_hand > 10000 and IQ < 50:
    print("Wow, some dumb people are sure rich!")
\end{Verbatim}


You might have been surprised to see the word ``\texttt{and}'' in that
\texttt{if} statement instead of the character ``\texttt{\&}''. I feel you.
It's totally inconsistent, but nevertheless true: although in a query, you must
use the symbols \texttt{\&}, \texttt{|}, and \texttt{\textasciitilde}, in an
\texttt{if} condition, you must use the words \texttt{and}, \texttt{or}, and
\texttt{not}. (In other news, the bananas around the components of an
\texttt{if} condition aren't necessary, but you can include them if you want.)

\index{double-equals (\texttt{==})}
\index{==@\texttt{==} (double-equals)}

For your convenience, the \texttt{if} condition operators are listed in
Figure~\ref{fig:ifStatementOps}. (\textbf{Remember} the double-equals!!)

% in and .isin()

\begin{figure}[b]
\centering
\small
\bigskip
\begin{tabular}{c|c}
Operator & Meaning \\
\hline
\texttt{>} & greater than \\
\hline
\texttt{<} & less than \\
\hline
\texttt{>=} & greater than or equal to \\
\hline
\texttt{<=} & less than or equal to \\
\hline
\texttt{!=} & \textit{not} equal to \\
\hline
\texttt{==} & equal to \\
\hline
\texttt{and} & and \\
\hline
\texttt{or} & or \\
\hline
\texttt{not} & not \\
\end{tabular}

\bigskip
\normalsize
\caption{Operators in \texttt{if} statements: simple and compound.}
\label{fig:ifStatementOps}
\end{figure}

\section{The \texttt{if}/\texttt{else} statement}

\index{if/else statement@\texttt{if}/\texttt{else} statement}
\index{else}

The above examples execute the \texttt{if} body as long as the condition is
true, and do nothing otherwise. It's common to want to do something else in the
``otherwise'' case instead, and for that, we have the \texttt{if}/\texttt{else}
statement.

\begin{Verbatim}[fontsize=\footnotesize,samepage=true,frame=single,framesep=3mm]
name = "Gladys"
cash_on_hand = 2000
IQ = 120
print("Nice to meet you, {}!".format(name))
if cash_on_hand > 5000:
    print("Wow, you're rich! Gimme a fiver.")
    cash_on_hand = cash_on_hand - 5
else:
    print("I wish you well!")
if IQ > 100:
    print("Wow, you're smart! Read a book.")
    IQ = IQ + 5
else:
    print("You're currently not that smart, but read a book and get smarter.")
    IQ = IQ + 10
print("{}'s IQ is {} and she has ${}.".format(name, IQ, cash_on_hand))
\end{Verbatim}
\vspace{-.2in}

\begin{Verbatim}[fontsize=\small,samepage=true,frame=leftline,framesep=5mm,framerule=1mm]
Nice to meet you, Gladys!
I wish you well!
Wow, you're smart! Read a book.
Gladys's IQ is 125 and she has $2000.
\end{Verbatim}

You can see that ``\texttt{I wish you well!}'' was printed, since
\texttt{cash\_on\_hand} was \textit{not} greater than 5000 (as required by the
\texttt{if} condition), and that the ``\dots\texttt{you're smart!}\dots''
message was printed but not the ``\dots\texttt{not that smart}\dots'' one.
Both the \texttt{if} part and the \texttt{else} part have an indented body,
although only the \texttt{if} part has a condition.

And that brings up another point. Although it hardly seems worth mentioning,
let me nevertheless emphasize this oft-overlooked truth:

\definecolor{shadecolor}{rgb}{.9,.9,.9}
\begin{shaded}
Whenever an \texttt{if}/\texttt{else} statement is reached,
\textbf{\textit{either} the \texttt{if} body \textit{or} the \texttt{else}
body will always be executed. It's never both, and it's never neither one.}
\end{shaded}

This is always, always true, because of the nature of things. The reason the
\texttt{else} header doesn't have a condition is because its condition is
implicitly \textit{the exact opposite} of the \texttt{if} condition. Period. In
\textit{any} case where the \texttt{if} condition isn't true -- and
\textit{only} in such a case -- will the \textbf{else} condition be executed.

To test whether you fully understand this point, see if you can predict the
output of the following program, which 99\% of beginning programmers get wrong:

\begin{Verbatim}[fontsize=\small,samepage=true,frame=single,framesep=3mm]
name = "Javier"
lang = "French"

if lang == "Spanish":
    print("Hola, {}!".format(name))
if lang == "French":
    print("Bonjour, {}!".format(name))
if lang == "Chinese":
    print("Ni hao, {}!".format(name))
else:
    print("Hello, {}!".format(name))
\end{Verbatim}
\vspace{-.2in}

Seriously, don't feel bad if you miss this one. The answer (*drum roll please*)
is:

\begin{Verbatim}[fontsize=\small,samepage=true,frame=leftline,framesep=5mm,framerule=1mm]
Bonjour, Javier!
Hello, Javier!
\end{Verbatim}

Wait...wut? Why did it print two messages? Surely if \texttt{Javier}'s
preferred language is \texttt{French}, it ought to say ``\texttt{Bonjour}'' and
skip all the other options?

To understand this behavior, you have to realize that an
\texttt{if}/\texttt{else} statement is a \textit{single} entity. This
multi-lingual greeting program has three components:

\begin{samepage}
\begin{compactenum}
\item an \texttt{if} statement
\item an \texttt{if} statement
\item an \texttt{if}/\texttt{else} statement
\end{compactenum}
\end{samepage}

\index{golden rule}

And you must remember our golden rule in the shaded box:
\textbf{\textit{either} the \texttt{if} body \textit{or} the \texttt{else} body
will always be executed: never both, and never neither one.} Therefore, the
above program does this:

\begin{samepage}
\begin{compactenum}
\item If the language is Spanish, print an ``Hola'' message. (Otherwise, do
nothing.)
\item If the language is French, print a ``Bonjour'' message. (Otherwise, do
nothing.)
\item If the language is Chinese print a ``Ni hao'' message. Otherwise, print a
``Hello'' message.
\end{compactenum}
\end{samepage}

Once you recognize that structure, you'll realize that when step 3 is
encountered, the program \textit{must} print either ``Ni hao'' or ``Hello.'' It
can't print both, and it can't print neither. An \texttt{if}/\texttt{else} just
doesn't work any other way.

\section{The \texttt{if}/\texttt{elif}/\texttt{else} statement}

\index{if/elif/else statement@\texttt{if}/\texttt{elif}/\texttt{else} statement}
\index{elif}

The problem with the previous example is that we really want our four languages
to be \textbf{mutually exclusive} options. If \texttt{lang} is
\texttt{"Spanish"}, we want it to print ``Hola'' and skip all the rest. The
easiest way to get this behavior is to use ``\texttt{elif}'' (a horrid
abbreviation of the phrase ``else if'').

Squint hard at this program until you see the differences between it and the
previous one:

\begin{Verbatim}[fontsize=\small,samepage=true,frame=single,framesep=3mm]
name = "Javier"
lang = "French"

if lang == "Spanish":
    print("Hola, {}!".format(name))
elif lang == "French":
    print("Bonjour, {}!".format(name))
elif lang == "Chinese":
    print("Ni hao, {}!".format(name))
else:
    print("Hello, {}!".format(name))
\end{Verbatim}

It's identical except that we replaced the second two \texttt{if}'s with
\texttt{elif}'s. This tells Python: only if the language is \textit{not}
Spanish should you then consider whether or not it's French. And only if it's
\textit{not} French (and \textit{not} Spanish) should you consider whether or
not it's Chinese. And only if it's not Chinese (and not French (and not
Spanish)) should you print ``Hello.''

Whether to use sequential \texttt{if}s or a chain of \texttt{elif}s isn't
always an easy question to answer. Neither choice is always right: you have to
think rigorously logically about how the program should act. Ask yourself: ``do
I want Python to consider \textit{all} of these conditions -- and execute the
appropriate \texttt{if} bodies -- no matter what? Or do I want it to bail out
as soon as it finds one that's true?'' Like most things, it takes practice to
get right.


% nested

% loops
